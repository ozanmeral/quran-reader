<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <title>Kur‚Äôan Okuyucu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="description" content="Sade, reklamsƒ±z ve √ßevrimdƒ±≈üƒ± Kur'an meali okuyucu.">
  <meta name="theme-color" content="#fdf6e3">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png">

  <style>
    /* --- TEMEL AYARLAR --- */
    :root {
      --bg-color: #fdf6e3; 
      --text-color: #2c3e50;
      --panel-bg: #ffffff;
      --border-color: #dcdcdc;
      --accent-color: #2c3e50; /* Daha koyu, daha net */
      --highlight: #e67e22;
      --nav-height: 80px; /* Alt bar y√ºksekliƒüi */
    }

    body.dark-mode {
      --bg-color: #121212;
      --text-color: #e0e0e0;
      --panel-bg: #1e1e1e;
      --border-color: #333333;
      --accent-color: #90caf9;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0; padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      padding-bottom: calc(var(--nav-height) + 20px); /* Alt bar payƒ± */
      padding-top: 60px; /* √úst bar payƒ± */
      overscroll-behavior-y: none; /* Lastik etkisini azalt */
    }

    /* --- √úST BAR (HEADER) --- */
    header {
      position: fixed; top: 0; left: 0; right: 0;
      height: 60px;
      background: var(--panel-bg);
      border-bottom: 1px solid var(--border-color);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 20px;
      padding-top: env(safe-area-inset-top); /* iPhone √áentik Payƒ± */
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    h1 { margin: 0; font-size: 1.3rem; font-weight: 800; color: var(--accent-color); }

    .settings-icon-btn {
      background: none; border: none; cursor: pointer;
      color: var(--text-color); padding: 10px;
      display: flex; align-items: center; justify-content: center;
    }
    .settings-icon-btn svg { width: 28px; height: 28px; fill: currentColor; }

    /* --- AYARLAR MODALI (EKRAN ORTASI) --- */
    .modal-overlay {
      display: none;
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 200;
      align-items: center; justify-content: center;
      backdrop-filter: blur(3px);
    }
    .modal-overlay.active { display: flex; }

    .settings-modal {
      background: var(--panel-bg);
      width: 90%; max-width: 400px;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      border: 1px solid var(--border-color);
    }

    .modal-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 20px; border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
    }
    .modal-header h2 { margin: 0; font-size: 1.2rem; }
    .close-btn {
      background: none; border: none; font-size: 2rem; line-height: 1;
      color: var(--text-color); cursor: pointer; padding: 0 10px;
    }

    .setting-row {
      margin-bottom: 20px;
    }
    .setting-label {
      display: block; font-weight: 600; margin-bottom: 8px; font-size: 1rem;
    }

    select, .btn-group { width: 100%; }
    
    select {
      padding: 12px; border-radius: 8px;
      background: var(--bg-color); color: var(--text-color);
      border: 1px solid var(--border-color);
      font-size: 1.1rem; height: 50px;
    }

    .btn-group { display: flex; height: 50px; }
    .btn-group button {
      flex: 1; border: 1px solid var(--border-color);
      background: var(--bg-color); color: var(--text-color);
      font-size: 1.2rem; cursor: pointer; font-weight: bold;
    }
    .btn-group button:first-child { border-radius: 8px 0 0 8px; }
    .btn-group button:last-child { border-radius: 0 8px 8px 0; border-left: none; }
    .btn-group button:active { background-color: var(--border-color); }

    /* --- ƒ∞√áERƒ∞K --- */
    main {
      max-width: 800px; margin: 0 auto; padding: 20px;
    }

    .surah-header {
      text-align: center; margin: 20px 0 40px 0;
      border-bottom: 3px double var(--border-color);
      padding-bottom: 20px;
    }
    .surah-name { font-size: 2rem; font-weight: 900; color: var(--highlight); display: block;}
    .surah-info { font-size: 0.9rem; opacity: 0.7; margin-top: 5px; display: block;}

    .verse-container {
      font-family: 'Georgia', serif;
      font-size: 1.3rem; 
      line-height: 1.7;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }
    .verse-num {
      display: inline-block;
      background-color: var(--border-color);
      color: var(--text-color);
      font-family: sans-serif;
      font-size: 0.9rem; font-weight: bold;
      padding: 2px 8px;
      border-radius: 12px;
      margin-right: 8px;
      vertical-align: text-top;
    }

    /* --- ALT NAVƒ∞GASYON (B√úY√úK VE SABƒ∞T) --- */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      height: var(--nav-height);
      background: var(--panel-bg);
      border-top: 1px solid var(--border-color);
      display: grid;
      grid-template-columns: 80px 1fr 80px;
      align-items: center;
      z-index: 100;
      padding-bottom: env(safe-area-inset-bottom); /* iPhone Home √áubuƒüu ƒ∞√ßin Bo≈üluk */
      box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
    }

    .nav-btn {
      background: var(--bg-color); border: none;
      color: var(--text-color);
      font-size: 2rem; /* √áok b√ºy√ºk ikonlar */
      cursor: pointer;
      height: 100%; width: 100%;
      display: flex; align-items: center; justify-content: center;
    }
    .nav-btn:active { background-color: var(--border-color); }

    /* Ortadaki Sure Se√ßimi */
    .nav-center { padding: 0 10px; height: 100%; display: flex; align-items: center; }
    #navSurahSelect {
      width: 100%; height: 50px;
      font-size: 1.1rem; font-weight: bold;
      text-align: center;
      border: 2px solid var(--border-color);
      background-color: var(--bg-color);
    }

    #loading { text-align: center; padding: 50px; font-size: 1.2rem; }
    .hidden { display: none !important; }

  </style>
</head>
<body>

  <header>
    <h1>Kur'an Oku</h1>
    <button class="settings-icon-btn" id="openSettings" aria-label="Ayarlar">
      <!-- Di≈üli ƒ∞konu -->
      <svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
    </button>
  </header>

  <!-- Ayarlar Modalƒ± -->
  <div class="modal-overlay" id="settingsModal">
    <div class="settings-modal">
      <div class="modal-header">
        <h2>Ayarlar</h2>
        <button class="close-btn" id="closeSettings">&times;</button>
      </div>

      <div class="setting-row">
        <label class="setting-label">√áeviri Kaynaƒüƒ±</label>
        <select id="sourceSelect"></select>
      </div>

      <div class="setting-row">
        <label class="setting-label">G√∂r√ºn√ºm Modu</label>
        <select id="themeSelect">
          <option value="light">‚òÄÔ∏è Aydƒ±nlƒ±k (G√ºnd√ºz)</option>
          <option value="dark">üåô Karanlƒ±k (Gece)</option>
        </select>
      </div>

      <div class="setting-row">
        <label class="setting-label">Yazƒ± Boyutu</label>
        <div class="btn-group">
          <button id="fontDec">A -</button>
          <button id="fontInc">A +</button>
        </div>
      </div>

      <div id="installContainer" class="setting-row hidden">
        <button id="installBtn" style="width:100%; padding:12px; background:var(--highlight); color:white; border:none; border-radius:8px; font-weight:bold;">Uygulamayƒ± Y√ºkle</button>
      </div>
    </div>
  </div>

  <main id="mainContent">
    <div id="loading">Sureler y√ºkleniyor...</div>
  </main>

  <nav class="bottom-nav">
    <button class="nav-btn" id="prevSurah">
      <svg style="width:36px;height:36px;fill:currentColor" viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </button>
    <div class="nav-center">
      <select id="navSurahSelect"></select>
    </div>
    <button class="nav-btn" id="nextSurah">
      <svg style="width:36px;height:36px;fill:currentColor" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
    </button>
  </nav>

  <script>
    const SOURCES = [
      { id: 'yasar', name: 'Ya≈üar Nuri √ñzt√ºrk', file: 'data/quranix_yasarnuri_simple.json' }
    ];

    let state = {
      currentSourceId: localStorage.getItem('q_source') || SOURCES[0].id,
      currentSurahNum: parseInt(localStorage.getItem('q_lastSurah')) || 1,
      fontSize: parseInt(localStorage.getItem('q_fontSize')) || 20, // Ya≈ülƒ±lar i√ßin varsayƒ±lanƒ± b√ºy√ºtt√ºk
      theme: localStorage.getItem('q_theme') || 'light',
      data: null
    };

    const els = {
      main: document.getElementById('mainContent'),
      modal: document.getElementById('settingsModal'),
      openBtn: document.getElementById('openSettings'),
      closeBtn: document.getElementById('closeSettings'),
      sourceSelect: document.getElementById('sourceSelect'),
      themeSelect: document.getElementById('themeSelect'),
      fontInc: document.getElementById('fontInc'),
      fontDec: document.getElementById('fontDec'),
      navSelect: document.getElementById('navSurahSelect'),
      prevBtn: document.getElementById('prevSurah'),
      nextBtn: document.getElementById('nextSurah'),
      installContainer: document.getElementById('installContainer'),
      installBtn: document.getElementById('installBtn')
    };

    async function init() {
      applyTheme();
      applyFontSize();
      
      els.sourceSelect.innerHTML = SOURCES.map(s => 
        `<option value="${s.id}" ${s.id===state.currentSourceId?'selected':''}>${s.name}</option>`
      ).join('');

      els.openBtn.onclick = () => els.modal.classList.add('active');
      els.closeBtn.onclick = () => els.modal.classList.remove('active');
      els.modal.onclick = (e) => { if(e.target === els.modal) els.modal.classList.remove('active'); }; // Dƒ±≈üarƒ± tƒ±klayƒ±nca kapat

      els.sourceSelect.onchange = (e) => loadSourceData(e.target.value);
      els.themeSelect.onchange = (e) => { state.theme = e.target.value; localStorage.setItem('q_theme', state.theme); applyTheme(); };
      els.fontInc.onclick = () => { state.fontSize = Math.min(40, state.fontSize + 2); saveFont(); };
      els.fontDec.onclick = () => { state.fontSize = Math.max(16, state.fontSize - 2); saveFont(); };
      
      els.navSelect.onchange = (e) => renderSurah(e.target.value);
      els.prevBtn.onclick = () => { if(state.currentSurahNum > 1) renderSurah(state.currentSurahNum - 1); };
      els.nextBtn.onclick = () => { if(state.currentSurahNum < 114) renderSurah(state.currentSurahNum + 1); };

      await loadSourceData(state.currentSourceId);
    }

    function saveFont() {
      localStorage.setItem('q_fontSize', state.fontSize);
      applyFontSize();
    }

    function applyTheme() {
      document.body.className = state.theme === 'dark' ? 'dark-mode' : '';
      els.themeSelect.value = state.theme;
      document.querySelector("meta[name=theme-color]").setAttribute("content", state.theme === 'dark' ? '#1e1e1e' : '#fdf6e3');
    }

    function applyFontSize() {
      const style = document.getElementById('dynFont') || document.createElement('style');
      style.id = 'dynFont';
      style.innerHTML = `.verse-container { font-size: ${state.fontSize}px !important; }`;
      document.head.appendChild(style);
    }

    async function loadSourceData(sourceId) {
      const source = SOURCES.find(s => s.id === sourceId);
      els.main.innerHTML = `<div id="loading">${source.name} y√ºkleniyor...</div>`;
      try {
        const res = await fetch(source.file);
        state.data = await res.json();
        state.currentSourceId = sourceId;
        localStorage.setItem('q_source', sourceId);
        
        // Dropdown doldur
        els.navSelect.innerHTML = state.data.surahs.map(s => 
          `<option value="${s.number}">${s.number}. ${s.name_tr.replace(/^\d+\.\s*/, '')}</option>`
        ).join('');
        
        renderSurah(state.currentSurahNum);
      } catch(e) {
        els.main.innerHTML = "Hata olu≈ütu: " + e;
      }
    }

    function renderSurah(num) {
      num = parseInt(num);
      const surah = state.data.surahs.find(s => s.number === num);
      if(!surah) return;

      state.currentSurahNum = num;
      localStorage.setItem('q_lastSurah', num);
      els.navSelect.value = num;

      // Buton durumlarƒ±
      els.prevBtn.style.opacity = num === 1 ? "0.3" : "1";
      els.nextBtn.style.opacity = num === 114 ? "0.3" : "1";

      window.scrollTo(0,0);

      let html = `
        <div class="surah-header">
          <span class="surah-name">${surah.name_tr}</span>
          <span class="surah-info">${surah.verses.length} Ayet</span>
        </div>
      `;

      html += surah.verses.map(v => `
        <div class="verse-container">
          <span class="verse-num">${v.number}</span> ${v.text_tr}
        </div>
      `).join('');
      
      html += '<div style="height:50px"></div>'; // Alt bo≈üluk
      els.main.innerHTML = html;
    }

    // PWA
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      els.installContainer.classList.remove('hidden');
    });
    els.installBtn.onclick = async () => {
      if(!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if(outcome === 'accepted') els.installContainer.classList.add('hidden');
      deferredPrompt = null;
    };

    if('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');

    init();
  </script>
</body>
</html>